
# 糖尿病

- インスリンが十分に働かないため、血液中を流れるブドウ糖(血糖)が増える病気
- インスリン：膵臓から出るホルモン、血糖を一定の範囲に収める働きを持つ
- 血糖値が高いまま放置すると血管が傷つき以下のような慢性合併症を引き起こす
  - 心臓病
  - 失明
  - 腎不全
  - 足の切断
- 著しく高い血糖は、それだけで昏睡などを起こすこともある（急性合併症）

## HbA1c（ヘモグロビンエーシーワン）

- 赤血球に含まれるヘモグロビンと血液中の糖が結びついた糖化タンパク質
- ヘモグロビン：赤血球内のたんぱく質の一種
- 過去1～2か月間の平均的な血糖値を反映
- 血糖値と異なり、食事の影響を受けないために食前・食後を問わずいつでも検査ができる
- 赤血球の平均寿命は120日（約4か月）と言われている
- 赤血球は血管の中を循環し、血糖が結合する
- つまり、HbA1cの値が高いほど平均的な血糖値が高い
- 赤血球は体内に20兆個存在
- 寿命を迎えた赤血球は1日当たり250万個脾臓で破壊される
- 同数の赤血球は骨髄で生産されて体内循環に入る
- 3～4か月前の赤血球は全体の10%程度と少ない
- そのため、HbA1cはおおむね1～2か月前の血糖値を反映する
- NGSP値とはHbA1cの国際標準の測定基準

```bash
HbA1c値(%) = HbA1cの量 / 全てのヘモグロビンの量
```

## 血糖とインスリン

- 食事する→糖→腸から吸収
- 食事なし→肝臓から糖が作られる
- 糖は血流にのって体の臓器や組織へめぐる
- 筋肉などの細胞にたどり着いた糖はインスリンの助けを借りて細胞に取り込まれる
- 取り込まれた糖は体が活動するためのエネルギー源
- インスリンは細胞のドアを開ける鍵のような役割を持つ
- インスリンの働きにより糖が細胞に取り込まれるため、糖が血液中にあふれることがない

## インスリンが十分に働かない原因

- インスリン分泌低下
  - 膵臓の機能の低下によりインスリンが作れなくなる
  - 膵臓でインスリンを作るβ細胞が壊れてしまう
  - インスリンを注射
- インスリン抵抗性
  - インスリンは作られる効果を発揮できない状態
  - 運動不足や食べすぎが原因で肥満になるとインスリンが働きにくくなる

# oracleDBについて

- 表領域：TABLESPACE
  - テーブルが格納される場所
  - XXXX.DBF
  - 実態ファイル、物理ファイル
  - 表領域→テーブル→データ
  - DBFファイルの中にテーブルやデータが論理情報として保管されている
  - 表領域単位でブロックサイズを変更する
    - キャッシュメモリ上に別のキャッシュ領域を設定

参考：[領域サイズの見積もり方法](http://otndnld.oracle.co.jp/deploy/maintenance/pdf/size_est.pdf)
参考：[データベース容量の見積もり式](https://www.fujitsu.com/downloads/JP/jsoft/resources/technical/man/systemwalker/security/desktop-keeper/v12.1/introduction/document/be-ins/ins02/ins00014.html)

## ブロックサイズ

- データを読み込むときの単位
- ブロックの中に複数の行データが格納されているイメージ
- デフォルトは8KB
- データベース作成時に決める
- 大きいメリット：一度に多くのデータを読み込む。よって速い。
- 大きいデメリット：
  - 不必要な行データまで取得する可能性があり、キャッシュ残る可能性もある
  - I/O競合が発生しやすくなる

参考：[Oracle ブロックサイズとレコードサイズとパフォーマンス](https://products.sint.co.jp/siob/blog/performance-block-size-record-size)
参考：[【ORACLE】ブロックサイズによるI/O性能の違い](https://oreno-it.info/archives/168)

## パラレル実行

二種類ある

- セッション単位
- SQL単位

## インデックス

```bash
アクセス速度 = データにアクセスする回数 × 1回の平均アクセス時間(平均サービスタイム)
```

- メリット
  - 特定のデータだけにアクセスする場合効果的にアクセスできる
  - 数%のデータにアクセスする場合索引スキャンは非常に高速
- デメリット
  - データ更新時にインデックス情報も更新するため時間がかかる
  - 容量の増加。インデックス情報もディスク上に存在するため容量が増える
  - アクセスするデータが多いとフルスキャンより遅くなる

***インデックス作成要領***

- 基本的にはカーディナリティの高い列に作成する
  - 複合インデックスの場合にはカーディナリティの高い順番に貼る
- 主キー以外で頻繁にWHERE句に指定される列に作成
- 多すぎると更新のオーバーヘッドになるので最小限にとどめておく
- 複数索引(複数列索引)作成要領(B木索引の場合 ※デフォルト時のインデックスはB木)
  - 一意性が高い索引を
  - 使用頻度の高い列を先頭に
  - 選択率の低い列を先頭に(選択率 = 絞り込んだ件数 / 総データ件数)
    - 具体的な閾値は5%~10%
    - 5%未満で絞り込める条件であればインデックスを貼る価値がある
  - 非ユニーク索引にはキー圧縮(索引圧縮)
- B-Treeインデックス
  - 参考：[B-Tree インデックス (B-Tree Index)](https://www.shift-the-oracle.com/index/btree-index.html)
  - 参考：[B-treeインデックス入門](https://qiita.com/kiyodori/items/f66a545a47dc59dd8839)
  
```sql
SQL> SELECT * FROM tab01 WHERE c1 < xxxx AND c2 = xxx;

SQL> CREATE INDEX ix_xxx ON tab01 (c1,c2);
SQL> CREATE INDEX ix_xxx ON tab01 (c2,c1); --こちらのほうが効率が良い
```

参考：[索引（インデックス）を作成するリスクやデメリット](https://oreno-it.info/archives/792)
参考：[第6回 パフォーマンスの基礎である索引について](https://www.oracle.com/technetwork/jp/database/articles/tsushima/tsm06-1598252-ja.html)
参考：[Oracle Databaseの索引（インデックス）の種類 - Bツリー、ビットマップ、索引構成表、索引クラスタ（ハッシュ・クラスタ）](https://blogs.oracle.com/oracle4engineer/oracle-database-b)

### ROWIDとは

- テーブルを作成すると内部的に作られる疑似列
- テーブル上の隠し列・仮の列であり通常は表示されない
- 18桁の一意な16進文字列で4つのパート 'OOOOOOFFFBBBBBBRRR' で構成されている
  - 6ByteのオブジェクトID(OOOOOO) ※ DBA_OBJECTSのDATA_OBJECT_ID(≠OBJECT_ID)と同じ
  - 3Byteのデータファイル番号(FFF)
  - 6Byteのブロック番号(BBBBBB)
  - 3Byteの行番号(RRR)
- 検索が速い・更新できない
- 格納ブロックのアドレスとそのブロック内の行番号までの情報を持つ
- 同じオブジェクトにおいてユニーク(オブジェクト内で同じROWIDを持つ行は存在しない)
- 単一レコードへの最速のアクセスpath
- アドレスへのポインタ情報のため格納領域を必要としない(0バイト)
- 物理ROWIDの場合オブジェクトID(OBJECT_ID)が判別できる
- 注意点
  - ROWIDは変わることがある。行を削除してバックアップから戻すと変わる可能性がある

```sql
--ROWIDを取得できない
SELECT * FROM emp;
--ROWIDを取得できる
SELECT rowid,empno FROM emp;
```

参考：[ROWID 擬似列](https://www.shift-the-oracle.com/sql/column/rowid.html)
参考：[OracleのROWIDとは？疑似列って何？](https://sql-oracle.com/?p=1593)
参考：[ROWID スキャンへの過剰な期待](https://www.shift-the-oracle.com/inside/rowid-scan-vs-index-scan.html)

## DB用語

- カーディナリティ：数学、特に集合論における濃度
  - カラムの値の種類の絶対数を表す(例：人間の性別なら2)
  - カーディナリティ度(選択度)
    - 低い：カラムの値の種類がレコード数に比べて少ない
    - 高い：カラムの値の種類がレコード数に比べて多い
    - 参考：[カーディナリティとは](https://www.shift-the-oracle.com/words/cardinality.html)
    - 参考：[カーディナリティについてまとめてみた](https://qiita.com/soyanchu/items/034be19a2e3cb87b2efb)


